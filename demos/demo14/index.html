<!DOCTYPE HTML>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <title>Test OSH-js API</title>
    
    <script type="text/javascript" src="js/osh-all.min.js"></script>
    
    <link rel="stylesheet" type="text/css" href="js/d3/css/nv.d3.css" />
    <script src="js/d3/js/d3.v3.min.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/d3/js/nv.d3.min.js"></script>
    <script type="text/javascript" src="js/d3/osh-UI-D3ChartView.js"></script>
    
    <style>
      .chart {
        width:750px;
        height:500px;
      }
    </style>
  </head>
  <body>
   <h2>This is a test chart for OSH-JS Api</h2>
   <h3>Simple use of D3 chart Viewer</h3>
    <div class="container-vertical">
      <label for="url">WebSocket Url:</label> 
      <input type="text" name="url" id="url"  size="50"/>
      <button type="button" onclick="load()">Load</button>
      <div id="container"><svg></svg></div>
    </div>
    <script type="text/javascript">
      function load() {
        var url = document.getElementById('url').value;
        loadStream(url);
      }
      function loadStream(url) {
          var dataSourceProvider = new OSH.DataSource.DataSourceProvider({
             bufferingTime:0, // 5 seconds
             synchronizedTime: false // does not sync the data,
          });
          
          var chartDataSource = new OSH.DataSource.ChartDataSource("chart",url);
          var chartDataSource2 = new OSH.DataSource.ChartDataSource("chart",url);
          
          //a view can be fed by a same stream
          var oshChartView = new OSH.UI.D3ChartView("container",{
            css: "chart",
            yLabel: "Test label Y"
          });
          
          dataSourceProvider.addDataSource(chartDataSource);
          dataSourceProvider.addDataSource(chartDataSource2);
          
          //set dataView
          oshChartView.addCurve({
              name: "curve1",
              dataViewId: chartDataSource.getId()
          });

          oshChartView.addCurve({
              name: "curve2",
              dataViewId: chartDataSource2.getId()
          });
          //CONTROLLER
          var controller = new OSH.Controller();
          controller.addDataSourceProvider(dataSourceProvider);
          controller.addView(oshChartView);
          
          chartDataSource.connect();
          chartDataSource2.connect();
      } // end load
    </script>
  </body>
</html>

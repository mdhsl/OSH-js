<!DOCTYPE HTML>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <title>Test x264 Video decoding</title>
    
    <!-- Hashtable -->
    <script type="text/javascript" src= "../js-local/src/common/jhashtable.js"></script>
    <script type="text/javascript" src= "../js-local/src/common/prototype.min.js"></script>
    
    <!-- OSH Core -->
    <script type="text/javascript" src="../js-local/src/osh/osh-template.js"></script>
    <!-- OSH buffer sync lib -->
    <script type="text/javascript" src="../js-local/src/osh/osh-utils.js"></script>
    
    <script type="text/javascript" src="../js-local/src/osh/osh-Buffer.js"></script>
    <!-- OSH controller lib -->
    <script type="text/javascript" src="../js-local/src/osh/osh-Controller.js"></script>
    <!-- OSH Video component parser -->
    <script type="text/javascript" src="../js-local/src/osh/osh-DataSourceConnector.js"></script>
    <script type="text/javascript" src="../js-local/src/osh/osh-DataSourceConnector-Websocket.js"></script>
    <script type="text/javascript" src="../js-local/src/osh/osh-DataSource.js"></script>
    <script type="text/javascript" src="../js-local/src/osh/osh-DataSource-mjpegvideo.js"></script>
    <script type="text/javascript" src="../js-local/src/osh/osh-DataSourceProvider.js"></script>
    <script type="text/javascript" src="../js-local/src/osh/osh-UI-View.js"></script>
    <script type="text/javascript" src="../js-local/src/osh/osh-UI-MJpegView.js"></script>
    
<style media="screen" type="text/css">
section {
  margin: auto;
}

.container-vertical {
  width:320px;
  float: left;
}

.container-vertical-2 {
  width:320px;
  float:left;
}

.container-vertical-3 {
  float:left;
}

.video {
  width : 600px;
  height: 500px;
}

</style>
  </head>
    <body>
     <h2>This is a test video for OSH-JS Api</h2>
     <h3>Use of two seperate Video dataSource + dataProvider + OSH View + CSS + Controller. The data are not synchronized. The videos 2 & 3 are fed by the same stream.
     The view is decorated to support the highlight of same streams.</h3>
     <h3>Use Options: { Buffering:2000, synchronizedTime: false }</h3>
     <h4>Click on a video</h4>
     <section>
        <div class="container-vertical">
          <button type="button" onclick="load()">Load</button>
          <div id="timestamp">TimeStamp: </div>
          <div id="container-video"></div>
        </div>
        <section>
          <div class="container-vertical-2">
            <button type="button" onclick="load2()">Load</button>
            <div id="timestamp-2">TimeStamp: </div>
            <div id="container-video-2"></div>
          </div>
          <div class="container-vertical-3">
            <div id="timestamp-3">TimeStamp: </div>
            <div id="container-video-3"></div>
          </div>
        </section>
      </section>
     
      <script type="text/javascript">
        OSH.UI.DecoratedMJpegView = Class.create(OSH.UI.MJpegView,{
            
            //overrides default select action
            selectDataView:function($super,dataViewId) {
              if(this.dataViewId == dataViewId) {
                //color div border
                document.getElementById(this.divId).style.border = "5px dotted red";
              } else {
                document.getElementById(this.divId).style.border = "none";
              }
            }
        });
      </script>
      <script type="text/javascript">
      
          //MODEL
          var videoDataSource1 = new OSH.DataSource.VideoMjpegDataSource("video1","ws://sensiasoft.net:8181/sensorhub/sos?service=SOS&version=2.0&request=GetResult&offering=urn:android:device:060693280a28e015-sos&observedProperty=http://sensorml.com/ont/swe/property/VideoFrame&temporalFilter=phenomenonTime,2015-02-16T08:00:00Z/2015-02-16T08:09:00Z&replaySpeed=3");
          var videoDataSource2 = new OSH.DataSource.VideoMjpegDataSource("video2","ws://sensiasoft.net:8181/sensorhub/sos?service=SOS&version=2.0&request=GetResult&offering=urn:android:device:060693280a28e015-sos&observedProperty=http://sensorml.com/ont/swe/property/VideoFrame&temporalFilter=phenomenonTime,2015-02-16T08:01:00Z/2015-02-16T08:09:00Z&replaySpeed=3");
          
          var dataSourceProvider = new OSH.DataSource.DataSourceProvider({
             bufferingTime:2*1000, // 5 seconds
             synchronizedTime: false, // does not sync the data
             replayFactor:3
          });
          
          dataSourceProvider.addDataSource(videoDataSource1);
          dataSourceProvider.addDataSource(videoDataSource2);
          
          //VIEW
          var oshVideoView1 = new OSH.UI.DecoratedMJpegView("container-video",{
            width: "300",
            height: "250"
          });
          
          //a view can be fed by a same stream
          var oshVideoView2 = new OSH.UI.DecoratedMJpegView("container-video-2",{
            width: "300",
            height: "250"
          });
          
          var oshVideoView3 = new OSH.UI.DecoratedMJpegView("container-video-3",{
            css:"video"            
          });
          
          //set dataView
          oshVideoView1.setDataViewId(videoDataSource1.getId());
          oshVideoView2.setDataViewId(videoDataSource2.getId());
          oshVideoView3.setDataViewId(videoDataSource2.getId());
          
          //CONTROLLER
          var controller = new OSH.Controller();
          controller.addDataSourceProvider(dataSourceProvider);
          controller.addView(oshVideoView1);
          controller.addView(oshVideoView2);
          controller.addView(oshVideoView3);
          
          // we can also use dataSourceProvider.connectAll() which will connect all streams
          function load() {
              videoDataSource1.connect();
          }
          
          function load2() {
              videoDataSource2.connect();
          }
      </script>
        
    </body>
</html>
